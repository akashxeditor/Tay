<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Video App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* ডিজাইন ও CSS একদম আগের মতোই রাখা হয়েছে */
        :root { --primary-color: #6200ea; --bg-color: #f4f7fa; --card-bg: #ffffff; --nav-height: 70px; }
        body { background-color: var(--bg-color); font-family: 'Poppins', sans-serif; padding-bottom: calc(var(--nav-height) + 20px); padding-top: 60px; }
        .top-header { background: white; box-shadow: 0 2px 15px rgba(0,0,0,0.03); height: 60px; z-index: 1000; }
        .app-title { font-weight: 600; color: #333; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .video-card { background: var(--card-bg); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.04); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); text-decoration: none; color: inherit; display: block; border: 1px solid rgba(0,0,0,0.02); }
        .video-card:active { transform: scale(0.98); }
        .thumb { width: 100%; height: 190px; object-fit: cover; background: #e0e0e0; }
        .card-body { padding: 14px; }
        .video-title { font-size: 0.95rem; font-weight: 600; color: #2c3e50; line-height: 1.4; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .video-date { font-size: 0.75rem; color: #95a5a6; display: block; }
        .bottom-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); height: var(--nav-height); border-top: 1px solid rgba(0,0,0,0.05); box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-item-custom { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; cursor: pointer; transition: all 0.3s ease; background: none; border: none; padding: 0; height: 100%; }
        .nav-item-custom i { font-size: 1.4rem; margin-bottom: 4px; transition: transform 0.2s; }
        .nav-item-custom span { font-size: 0.75rem; font-weight: 500; }
        .nav-item-custom.active { color: var(--primary-color); }
        .nav-item-custom.active i { transform: translateY(-2px); }
        .webview-container { width: 100%; height: calc(100vh - 140px); border-radius: 12px; overflow: hidden; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        iframe { width: 100%; height: 100%; border: none; }
        .loading-container { display: flex; justify-content: center; padding-top: 50px; }
    </style>
</head>
<body>

    <nav class="navbar fixed-top top-header px-3">
        <div class="container-fluid p-0">
            <span class="app-title"><i class="bi bi-play-circle-fill text-primary"></i> Viral Clips</span>
            <i class="bi bi-bell fs-5 text-secondary"></i> 
        </div>
    </nav>

    <div class="container mt-3">
        <div id="section-home" class="animate-fade">
            <div id="grid" class="row g-3">
                <div class="loading-container"><div class="spinner-border text-primary" role="status"></div></div>
            </div>
        </div>
        <div id="section-news" class="d-none">
            <div class="webview-container"><iframe src="https://www.bbc.com/bengali"></iframe></div>
        </div>
        <div id="section-setting" class="d-none">
            <div class="webview-container"><iframe src="https://example.com"></iframe></div>
        </div>
    </div>

    <nav class="navbar fixed-bottom bottom-nav p-0">
        <div class="container-fluid h-100 p-0 d-flex">
            <button class="nav-item-custom active" onclick="switchTab('home')"><i class="bi bi-house-door-fill"></i><span>Home</span></button>
            <button class="nav-item-custom" onclick="switchTab('news')"><i class="bi bi-newspaper"></i><span>News</span></button>
            <button class="nav-item-custom" onclick="switchTab('setting')"><i class="bi bi-gear-fill"></i><span>Setting</span></button>
        </div>
    </nav>

    <script>
        function switchTab(tabName) {
            document.getElementById('section-home').classList.add('d-none');
            document.getElementById('section-news').classList.add('d-none');
            document.getElementById('section-setting').classList.add('d-none');
            const navButtons = document.querySelectorAll('.nav-item-custom');
            navButtons.forEach(btn => btn.classList.remove('active'));

            if (tabName === 'home') {
                document.getElementById('section-home').classList.remove('d-none');
                navButtons[0].classList.add('active');
            } else if (tabName === 'news') {
                document.getElementById('section-news').classList.remove('d-none');
                navButtons[1].classList.add('active');
            } else if (tabName === 'setting') {
                document.getElementById('section-setting').classList.remove('d-none');
                navButtons[2].classList.add('active');
            }
        }

        // --- EDGE FUNCTION LOGIC ---
        const API_URL = "https://zaddbqhvwakcnqelwaxs.supabase.co/functions/v1/rapid-worker";
        const grid = document.getElementById('grid');

        // ডাটা ফেচ করা হচ্ছে
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                grid.innerHTML = "";
                
                // যদি ডাটা Array হিসেবে আসে
                let list = Array.isArray(data) ? data : Object.values(data);

                if(list.length === 0) { 
                    grid.innerHTML = "<div class='col-12 text-center text-muted mt-5'><i class='bi bi-folder2-open display-1'></i><p class='mt-3'>No videos found</p></div>"; 
                    return; 
                }

                // ডাটা রিভার্স করে দেখানো হচ্ছে
                list.reverse().forEach(v => {
                    // নোট: 'v.k' বা 'v.id' যা আপনার API রিটার্ন করে সেটা ব্যবহার করবেন। আমি 'v.id' ধরে নিয়েছি।
                    let vID = v.id || v.k || v.key; 
                    
                    grid.innerHTML += `
                        <div class="col-12 col-md-4 col-lg-3">
                            <a href="post.html?id=${vID}" class="video-card">
                                <img src="${v.thumbnail}" class="thumb" onerror="this.src='https://placehold.co/600x400/e0e0e0/888888?text=Video'">
                                <div class="card-body">
                                    <h6 class="video-title">${v.title}</h6>
                                    <span class="video-date">${v.time ? new Date(v.time).toLocaleDateString() : 'N/A'}</span>
                                </div>
                            </a>
                        </div>
                    `;
                });
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                grid.innerHTML = "<div class='col-12 text-center text-danger mt-5'><p>Error loading content.</p></div>";
            });
    </script>
</body>
</html>
